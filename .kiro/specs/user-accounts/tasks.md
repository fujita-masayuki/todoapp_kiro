# 実装計画

- [x] 1. バックエンド基盤の構築
  - Userモデルとデータベーススキーマを作成し、認証の基盤を構築する
  - bcrypt gemを追加してパスワードハッシュ化を有効にする
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 7.1, 7.2, 7.3, 7.4_

- [x] 1.1 Userモデルとマイグレーションの作成
  - User モデルクラスを作成し、email、password_digest フィールドを定義する
  - has_secure_password を使用してパスワード認証機能を追加する
  - email の一意性とパスワードの複雑性バリデーションを実装する
  - データベースマイグレーションを作成してusersテーブルを追加する
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 7.1, 7.2, 7.3, 7.4_

- [x] 1.2 Todoモデルにuser_id外部キーを追加
  - todos テーブルに user_id カラムを追加するマイグレーションを作成する
  - Todo モデルに belongs_to :user の関連を追加する
  - User モデルに has_many :todos の関連を追加する
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 2. JWT認証システムの実装
  - JWT トークンの生成と検証機能を実装する
  - 認証ミドルウェアを作成してAPIエンドポイントを保護する
  - _要件: 2.4, 5.1, 5.2, 5.3, 5.4, 7.4_

- [x] 2.1 JWT認証ヘルパーの実装
  - JWT gem を Gemfile に追加する
  - JWT トークンのエンコード・デコード機能を実装する
  - トークンの有効期限とペイロード管理を実装する
  - _要件: 2.4, 5.1, 5.2, 5.3, 5.4, 7.4_

- [x] 2.2 認証ミドルウェアの作成
  - リクエストヘッダーからJWTトークンを抽出する機能を実装する
  - トークンを検証して現在のユーザーを設定する機能を実装する
  - 認証が必要なコントローラーで使用するbefore_actionを実装する
  - _要件: 2.4, 5.1, 5.2, 5.3, 5.4_

- [x] 3. 認証APIエンドポイントの実装
  - ユーザー登録とログイン機能のAPIエンドポイントを作成する
  - 適切なエラーハンドリングとレスポンス形式を実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 3.1, 3.2_

- [x] 3.1 ユーザー登録APIの実装
  - Api::V1::UsersController を作成する
  - POST /api/v1/users エンドポイントでユーザー登録機能を実装する
  - バリデーションエラーと成功レスポンスの適切な処理を実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3.2 ログイン・ログアウトAPIの実装
  - Api::V1::SessionsController を作成する
  - POST /api/v1/sessions エンドポイントでログイン機能を実装する
  - DELETE /api/v1/sessions エンドポイントでログアウト機能を実装する
  - 認証失敗時の適切なエラーレスポンスを実装する
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2_

- [x] 4. Todosコントローラーの認証対応
  - 既存のTodosコントローラーに認証機能を追加する
  - ユーザー固有のTodoのみを操作できるように制限する
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 4.1 Todosコントローラーに認証を追加
  - TodosController に認証ミドルウェアを適用する
  - current_user ヘルパーを使用してユーザー固有のTodoを取得する
  - Todo作成時に自動的にuser_idを設定する機能を実装する
  - 他のユーザーのTodoへのアクセスを防ぐ認可チェックを実装する
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 5. フロントエンド認証コンテキストの実装
  - React Context APIを使用してアプリケーション全体の認証状態を管理する
  - ログイン、登録、ログアウト機能を提供する
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 5.1, 5.2, 5.3, 5.4_

- [x] 5.1 認証コンテキストとプロバイダーの作成
  - AuthContext を作成してユーザー状態とメソッドを定義する
  - AuthProvider コンポーネントを実装してアプリケーション全体に認証状態を提供する
  - localStorage を使用してトークンの永続化を実装する
  - アプリケーション起動時の認証状態復元機能を実装する
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [x] 5.2 認証APIサービスの実装
  - 既存のapi.tsファイルに認証関連のAPI呼び出し機能を追加する
  - login、register、logout のAPI呼び出し関数を実装する
  - JWTトークンを自動的にリクエストヘッダーに追加する機能を実装する
  - 認証エラー時の自動ログアウト処理を実装する
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 5.4_

- [x] 6. 認証UIコンポーネントの実装
  - ログインと登録のフォームコンポーネントを作成する
  - フォームバリデーションとエラー表示を実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3_

- [x] 6.1 ログインフォームコンポーネントの作成
  - LoginForm コンポーネントを作成してメールとパスワード入力フィールドを実装する
  - フォーム送信時の認証処理とエラーハンドリングを実装する
  - バリデーションエラーとサーバーエラーの表示機能を実装する
  - _要件: 2.1, 2.2, 2.3_

- [x] 6.2 登録フォームコンポーネントの作成
  - RegisterForm コンポーネントを作成してメール、パスワード、パスワード確認フィールドを実装する
  - クライアントサイドのパスワード複雑性バリデーションを実装する
  - 登録成功時のリダイレクト処理を実装する
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 7. ルーティングと保護されたページの実装
  - React Router を使用してページルーティングを実装する
  - 認証が必要なページを保護する機能を追加する
  - _要件: 3.3, 5.4, 6.3_

- [x] 7.1 React Routerの設定とページコンポーネント
  - react-router-dom をプロジェクトに追加する
  - App.tsx にルーティング設定を実装する
  - Login、Register、Todos の各ページコンポーネントを作成する
  - _要件: 6.3_

- [x] 7.2 保護されたルートコンポーネントの実装
  - ProtectedRoute コンポーネントを作成して認証チェック機能を実装する
  - 未認証ユーザーをログインページにリダイレクトする機能を実装する
  - 認証済みユーザーが認証ページにアクセスした場合のリダイレクト処理を実装する
  - _要件: 3.3, 5.4, 6.3_

- [x] 8. ナビゲーションとUI統合
  - 認証状態に応じたナビゲーションバーを実装する
  - 既存のTodoアプリUIを認証システムと統合する
  - _要件: 6.1, 6.2, 6.4_

- [x] 8.1 ナビゲーションバーコンポーネントの実装
  - Navbar コンポーネントを作成して認証状態に応じた表示を実装する
  - ログイン済みユーザーにはメールアドレスとログアウトボタンを表示する
  - 未ログインユーザーにはログインと登録リンクを表示する
  - ログアウト機能とページ遷移を実装する
  - _要件: 6.1, 6.2, 6.4_

- [x] 8.2 既存TodoアプリのUI統合
  - 既存のApp.tsx を認証システムと統合する
  - 認証済みユーザーのみがTodo機能にアクセスできるように修正する
  - ナビゲーションバーを全ページに追加する
  - _要件: 4.1, 6.1, 6.2, 6.4_

- [x] 9. エラーハンドリングとユーザビリティの向上
  - 統一されたエラーハンドリングシステムを実装する
  - ユーザーフレンドリーなエラーメッセージとローディング状態を追加する
  - _要件: 1.3, 2.3, 5.3, 5.4_

- [x] 9.1 統一エラーハンドリングの実装
  - API エラーレスポンスの統一処理機能を実装する
  - 認証エラー時の自動ログアウトとリダイレクト処理を実装する
  - ユーザーフレンドリーなエラーメッセージの表示機能を実装する
  - _要件: 1.3, 2.3, 5.3, 5.4_

- [x] 9.2 ローディング状態とUX改善
  - 認証処理中のローディング表示を実装する
  - フォーム送信中の無効化とフィードバック表示を実装する
  - 成功メッセージとトースト通知の表示機能を実装する
  - _要件: 1.2, 2.2_

- [ ] 10. テストの実装
  - バックエンドとフロントエンドの主要機能に対するテストを作成する
  - 認証フローの統合テストを実装する
  - _要件: 全要件のテストカバレッジ_

- [ ] 10.1 バックエンドテストの実装
  - User モデルのバリデーションテストを作成する
  - 認証コントローラーのAPIテストを作成する
  - JWT認証ミドルウェアのテストを作成する
  - 保護されたTodos APIのテストを作成する
  - _要件: 全要件のバックエンドテストカバレッジ_

- [ ] 10.2 フロントエンドテストの実装
  - 認証コンテキストの単体テストを作成する
  - ログイン・登録フォームのコンポーネントテストを作成する
  - 保護されたルートの動作テストを作成する
  - 認証フロー全体の統合テストを作成する
  - _要件: 全要件のフロントエンドテストカバレッジ_